---
title: "surveydown:<br>An Open-Source, Markdown-Based Platform for Interactive and Reproducible Surveys"
author: "Pingfan Hu, Bogdan Bunea, John Paul Helveston"
format:
  revealjs: 
    smaller: false
    theme: theme.scss
    css: slides.css
    slide-number: true
    embed-resources: true
    auto-stretch: false
    preview-links: auto
    link-external-newwindow: true
    link-external-icon: false
    center-title-slide: false
    code-block-height: 650px
    title-slide-attributes: 
      data-background-image: figs/sd_transparent.png
      data-background-size: 20%
      data-background-opacity: "1"
      class: custom-title-slide
shortcodes:
  - surveycode.lua
execute: 
  warning: false
  echo: false
---

```{r}
#| label: setup
#| include: false
library(tidyverse)
library(kableExtra)
library(googlesheets4)
```

## slide1

{{< surveycode >}}

## [What do we want from a survey platform?]{style="text-align: center"} {.center}

## Survey Features {style="text-align: center;"}

::: {.grid-container}
::: {.centered-orange .container .fragment}
Free to Use
:::

::: {.centered-orange .container .fragment}
Open Source
:::

::: {.centered-orange .container .fragment}
Learning Curve
:::

::: {.centered-orange .container .fragment}
Reproducible
:::

::: {.centered-orange .container .fragment}
Generalizable
:::

::: {.centered-orange .container .fragment}
Feature Packed...
:::
:::

## Existing Survey Platforms {style="text-align: center;"}

```{r}
#| label: comparison-table
gs4_deauth()
comparisons <- read_sheet("1zlaNbhzOQAJnVlT8t_WmDv-uAnHwvDCb66vwYtVU5M8")
comparisons %>% 
  kbl(align = c("l", "c", "c", "c", "c", "c", "c")) %>% 
  kable_styling(font_size = 20, bootstrap_options = "basic", 
                html_font = "inherit",
                full_width = FALSE,
                position = "center") %>%
  row_spec(0:nrow(comparisons), extra_css = "vertical-align: middle !important; height: 2em;") %>%
  row_spec(nrow(comparisons), color = "#FF5733", font_size = 28) %>%
  column_spec(1, bold = TRUE)
```

## Introducing `surveydown` {style="text-align: center"}

<br>

![](figs/technologies.svg){fig-align="center" width="90%"}

## Components {style="text-align: center;"}

::: columns

::: {.column width="50%"}

### `survey.qmd` {style="text-align: center; font-size: 36px; color: #739C69; padding-top: 3em;"}

A **Quarto doc** defining the main survey content (pages, text, images, questions, etc).

:::

::: {.column width="50%"}

### `app.R` {style="text-align: center; font-size: 36px; color: #739C69; padding-top: 3em;"}

An **R script** defining the survey Shiny app. It sets up the database and server, and launches the survey.

:::

:::











## {style="font-size: 0.6em;"}

::: columns

::: {.column width="14%"}

survey.qmd 
file

:::

::: {.column width="43%"}

````{r}
#| eval: false
#| echo: true

---
format: html
echo: false
warning: false
---

```{r}
library(surveydown)
```

::: {#welcome .sd-page}

# Welcome to our survey!

```{r}
sd_question(
  type  = 'mc',
  id    = 'penguins',
  label = "What's your favorite penguin?",
  option = c(
    'Adélie'    = 'adelie',
    'Chinstrap' = 'chinstrap',
    'Gentoo'    = 'gentoo'
  )
)

sd_next()
```

:::

::: {#end .sd-page}

This is the last page of the survey.

```{r}
sd_close()
```

:::

````

:::

::: {.column width="43%"}

::: {.surveyqmd-texts}

YAML Header

:::

::: {.surveyqmd-texts style="display: block; transform: none; top: 14%;"}

Load Package

:::

:::

:::








## {style="font-size: 0.6em;"}

::: columns

::: {.column width="14%"}

survey.qmd 
file

:::

::: {.column width="43%"}

````{r}
#| eval: false
#| echo: true
#| code-line-numbers: "11,30,32,40"

---
format: html
echo: false
warning: false
---

```{r}
library(surveydown)
```

::: {#welcome .sd-page}

# Welcome to our survey!

```{r}
sd_question(
  type  = 'mc',
  id    = 'penguins',
  label = "What's your favorite penguin?",
  option = c(
    'Adélie'    = 'adelie',
    'Chinstrap' = 'chinstrap',
    'Gentoo'    = 'gentoo'
  )
)

sd_next()
```

:::

::: {#end .sd-page}

This is the last page of the survey.

```{r}
sd_close()
```

:::

````

:::

::: {.column width="43%"}

Define pages uses "fences" (`:::`)

::: {.surveyqmd-texts style="display: block; transform: none; top: 24%;"}

Page 1 (Welcome)

:::

::: {.surveyqmd-texts style="display: block; transform: none; top: 71%;"}

Page 2 (End)

:::

:::

:::













## {style="font-size: 0.6em;"}

::: columns

::: {.column width="14%"}

survey.qmd 
file

:::

::: {.column width="43%"}

````{r}
#| eval: false
#| echo: true
#| code-line-numbers: "13-28"

---
format: html
echo: false
warning: false
---

```{r}
library(surveydown)
```

::: {#welcome .sd-page}

# Welcome to our survey!

```{r}
sd_question(
  type  = 'mc',
  id    = 'penguins',
  label = "What's your favorite penguin?",
  option = c(
    'Adélie'    = 'adelie',
    'Chinstrap' = 'chinstrap',
    'Gentoo'    = 'gentoo'
  )
)

sd_next()
```

:::

::: {#end .sd-page}

This is the last page of the survey.

```{r}
sd_close()
```

:::

````

:::

::: {.column width="43%"}

::: {.surveyqmd-texts style="display: block; transform: none; top: 28%;"}

Contents of Page 1

:::

:::

:::





























## `survey.qmd` {.smaller}

::: columns
::: {.column width="50%"}

````{r}
#| eval: false
#| echo: true
#| code-line-numbers: "9-16"
```{r}
library(surveydown)
```

::: {#welcome .sd-page}
# Welcome to our survey!

```{r}
sd_question(
  type   = 'mc',
  id     = 'penguins',
  label  = "Which penguin do you like?",
  option = c('Adélie'    = 'adelie',
             'Chinstrap' = 'chinstrap',
             'Gentoo'    = 'gentoo')
)

sd_next()
```
:::

::: {#end .sd-page}
This is the last page of the survey.

```{r}
sd_close()
```
:::
````

:::

::: {.column width="50%"}
::: {.surveyqmd-texts style="display: block; transform: none; top: 40%;"}
Question Definition
:::
:::
:::

## `app.R` {.smaller}

::: columns
::: {.column width="50%"}

````{r}
#| eval: false
#| echo: true
# Load Package
library(surveydown)

# Database Credentials
sd_db_config()
# Connect to Database
db <- sd_db_connect()

# Server Setup
server <- function(input, output, session) {

  # Skip logic
  sd_skip_if(...)

  # Conditional display
  sd_show_if(...)

  # Server settings
  sd_server(...)
}

# Launch Survey
shiny::shinyApp(ui = sd_ui(), server = server)
````

:::

::: {.column width="50%"}
::: {.surveyqmd-texts style="display: block; transform: none;"}
Load Package
:::

::: {.surveyqmd-texts style="display: block; transform: none; top: 22%;"}
Database Setup
:::

::: {.surveyqmd-texts style="display: block; transform: none; top: 48%;"}
Server Setup
:::

::: {.surveyqmd-texts style="display: block; transform: none; top: 70%;"}
Launch Survey
:::
:::
:::

## `app.R` {.smaller}

::: columns
::: {.column width="50%"}

````{r}
#| eval: false
#| echo: true
#| code-line-numbers: "1-2"
# Load Package
library(surveydown)

# Database Credentials
sd_db_config()
# Connect to Database
db <- sd_db_connect()

# Server Setup
server <- function(input, output, session) {

  # Skip logic
  sd_skip_if(...)

  # Conditional display
  sd_show_if(...)

  # Server settings
  sd_server(...)
}

# Launch Survey
shiny::shinyApp(ui = sd_ui(), server = server)
````

:::

::: {.column width="50%"}
::: {.surveyqmd-texts style="display: block; transform: none;"}
Load Package
:::
:::
:::

## `app.R` {.smaller}

::: columns
::: {.column width="50%"}

````{r}
#| eval: false
#| echo: true
#| code-line-numbers: "4-7"
# Load Package
library(surveydown)

# Database Credentials
sd_db_config()
# Connect to Database
db <- sd_db_connect()

# Server Setup
server <- function(input, output, session) {

  # Skip logic
  sd_skip_if(...)

  # Conditional display
  sd_show_if(...)

  # Server settings
  sd_server(...)
}

# Launch Survey
shiny::shinyApp(ui = sd_ui(), server = server)
````

:::

::: {.column width="50%"}
::: {.surveyqmd-texts style="display: block; transform: none; top: 22%;"}
Database Setup
:::
:::
:::

::: {.fragment style="text-align: center; padding-top: 1em;"}
We recommend using **Supabase** or any **PostgreSQL** database for the database setup.
:::

## `app.R` {.smaller}

::: columns
::: {.column width="50%"}

````{r}
#| eval: false
#| echo: true
#| code-line-numbers: "9-20"
# Load Package
library(surveydown)

# Database Credentials
sd_db_config()
# Connect to Database
db <- sd_db_connect()

# Server Setup
server <- function(input, output, session) {

  # Skip logic
  sd_skip_if(...)

  # Conditional display
  sd_show_if(...)

  # Server settings
  sd_server(...)
}

# Launch Survey
shiny::shinyApp(ui = sd_ui(), server = server)
````

:::

::: {.column width="50%"}
::: {.surveyqmd-texts style="display: block; transform: none; top: 48%;"}
Server Setup
:::
:::
:::

## `app.R` {.smaller}

::: columns
::: {.column width="50%"}

````{r}
#| eval: false
#| echo: true
#| code-line-numbers: "22-23"
# Load Package
library(surveydown)

# Database Credentials
sd_db_config()
# Connect to Database
db <- sd_db_connect()

# Server Setup
server <- function(input, output, session) {

  # Skip logic
  sd_skip_if(...)

  # Conditional display
  sd_show_if(...)

  # Server settings
  sd_server(...)
}

# Launch Survey
shiny::shinyApp(ui = sd_ui(), server = server)
````

:::

::: {.column width="50%"}
::: {.surveyqmd-texts style="display: block; transform: none; top: 70%;"}
Launch Survey
:::
:::
:::

## [Templates and demos are provided for an easy start.]{style="text-align: center"} {.center}

## Demo - Built-in Question Types {style="text-align: center;"}

[![](figs/demo_1.png){width="80%" fig-align="center" style="border: 2px solid #5654A2;"}](https://surveydown.shinyapps.io/types/)

## Demo - `leaflet` Map {style="text-align: center;"}

[![](figs/demo_2.png){width="80%" fig-align="center" style="border: 2px solid #5654A2;"}](https://surveydown2.shinyapps.io/leaflet/)

## [Check out [surveydown.org](https://surveydown.org) for more!]{style="text-align: center; display: block;"} {.center}